--- src/src/llvm/lib/Support/Unix/Path.inc.orig
+++ src/src/llvm/lib/Support/Unix/Path.inc
@@ -38,7 +38,9 @@
 #ifdef __APPLE__
 #include <mach-o/dyld.h>
 #include <sys/attr.h>
+#if __has_include(<copyfile.h>)
 #include <copyfile.h>
+#endif
 #elif defined(__FreeBSD__)
 #include <osreldate.h>
 #if __FreeBSD_version >= 1300057
@@ -1347,7 +1349,7 @@
 
 namespace fs {
 
-#ifdef __APPLE__
+#if defined(__APPLE__) && __has_include(<copyfile.h>)
 /// This implementation tries to perform an APFS CoW clone of the file,
 /// which can be much faster and uses less space.
 /// Unfortunately fcopyfile(3) does not support COPYFILE_CLONE, so the
