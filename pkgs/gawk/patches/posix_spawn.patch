--- src/posix/gawkmisc.c.orig
+++ src/posix/gawkmisc.c
@@ -344,7 +344,7 @@
 			(void) unsetenv("GAWK_PMA_REINCARNATION");
 	}
 #endif
-#ifdef HAVE__NSGETEXECUTABLEPATH
+#if defined(HAVE__NSGETEXECUTABLEPATH) && __has_include(<spawn.h>)
 	// This code is for macos
 	if (persist_file != NULL) {
 		const char *cp = getenv("GAWK_PMA_REINCARNATION");
